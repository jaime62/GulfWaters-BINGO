<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CSV List Conversion Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 1rem; }
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 0.5rem;
      margin-bottom: 1rem;
      font-family: monospace;
    }
    .output-preview {
      border: 1px solid #ccc;
      padding: 1rem;
      background: #fff;
    }
    button {
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    .category {
      background: #92D6B5;
      color: #1a237e;
      padding: .5rem;
      margin-bottom: 0.5rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .category-content {
      display: none;
      margin-bottom: 1rem;
    }
    .subcategory {
      background: #e6fafa;
      padding: 0.25rem 1rem;
      font-style: italic;
      font-weight: bold;
      color: #333;
    }
    .sub-subcategory {
      margin-left: 1rem;
      padding: 0.25rem 0;
    }
    .sub-subcategory ul {
      padding-left: 1.5rem;
      margin: 0;
    }
    .sub-subcategory li {
      margin: 0.25rem 0;
    }
    .sub-subcategory a {
      color: #003333;
      text-decoration: none;
    }
    .sub-subcategory a:hover {
      text-decoration: underline;
    }
    .emoji {
      height: 36px;
      margin-right: 0.5rem;
      vertical-align: middle;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
  </style>
</head>
<body>

  <div style="display: flex; align-items: center; gap: 12px;">
    <img src="https://github.com/jaime62/Wheatons-World/blob/main/app/tools/WW_tools_medium.png?raw=true"
         alt="Toolbox Icon" style="height: 48px;">
    <h2 style="margin: 0;">CSV List Conversion Tool</h2>
  </div>

  <p>Paste your CSV data below (Category, Subcategory, Sub-subcategory [ignored], &lt;li&gt;Item Link&lt;/li&gt;):</p>
  <textarea id="csvInput" placeholder="Category,Subcategory,Sub-subcategory,&lt;li&gt;Item Link&lt;/li&gt;"></textarea>
  <button onclick="convertCSV()" style="background-color: green; color: white;">Convert</button>
  <button onclick="resetFields()" style="background-color: red; color: white;">Clear ALL</button>

  <h3>Generated HTML Code:</h3>
  <textarea id="htmlOutput" readonly></textarea>
  <button onclick="copyToClipboard()" style="background-color: blue; color: white;">Copy HTML to Clipboard</button>
  <button onclick="saveAsHTML()" style="background-color: orange; color: black;">Save as HTML</button>

  <h3>Live Preview:</h3>
  <div id="livePreview" class="output-preview"></div>

  <script>
    const fullCSS = `
body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 1rem; }
textarea {
  width: 100%;
  min-height: 150px;
  padding: 0.5rem;
  margin-bottom: 1rem;
  font-family: monospace;
}
.output-preview {
  border: 1px solid #ccc;
  padding: 1rem;
  background: #fff;
}
button {
  margin-bottom: 1rem;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  cursor: pointer;
}
.category {
  background: #92D6B5;
  color: #1a237e;
  padding: .5rem;
  margin-bottom: 0.5rem;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}
.category-content {
  display: none;
  margin-bottom: 1rem;
}
.subcategory {
  background: #e6fafa;
  padding: 0.25rem 1rem;
  font-style: italic;
  font-weight: bold;
  color: #333;
}
.sub-subcategory {
  margin-left: 1rem;
  padding: 0.25rem 0;
}
.sub-subcategory ul {
  padding-left: 1.5rem;
  margin: 0;
}
.sub-subcategory li {
  margin: 0.25rem 0;
}
.sub-subcategory a {
  color: #003333;
  text-decoration: none;
}
.sub-subcategory a:hover {
  text-decoration: underline;
}
.emoji {
  height: 36px;
  margin-right: 0.5rem;
  vertical-align: middle;
}
.container {
  max-width: 600px;
  margin: auto;
}
`;

    const emojiMap = {
      "Apparel & Protection": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-swimsuit.png?raw=true",
      "Boating Accessories": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-anchor-rope.png?raw=true",
      "Electronics": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-fish-finder.png?raw=true",
      "Rods & Reels": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-rod-reel.png?raw=true",
      "Storage": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-tackle-box.png?raw=true",
      "Tackle": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-lure.png?raw=true",
      "Tools": "https://github.com/jaime62/Wheatons-World/blob/main/app/Tech-Tackle-Box/images/emoji-plier-gaff.png?raw=true"
    };

    function getCategoryIcon(category) {
      const icon = emojiMap[category];
      return icon ? `<img class="emoji" src="${icon}" alt="${category} Emoji">` : `<span class="emoji">üêü</span>`;
    }

    function sanitize(str) {
      return str.replace(/^"+|"+$/g, '').replace(/""/g, '"').trim();
    }

    function convertCSV() {
      const csv = document.getElementById("csvInput").value.trim();
      const lines = csv.split("\n").filter(line => line.trim());
      if (lines.length < 2) return;

      const data = lines.slice(1); // skip header row
      let htmlBody = '';
      let currentCategory = '', currentSubcategory = '';
      let subSubcategoryOpen = false;

      for (const line of data) {
        const [category, subcategory, _ignored, liItem] = line.split(",").map(sanitize);
        if (!category || !subcategory || !liItem) continue;

        if (category !== currentCategory) {
          if (subSubcategoryOpen) {
            htmlBody += '</ul></div>\n';
            subSubcategoryOpen = false;
          }
          if (currentCategory !== '') {
            htmlBody += '</div>\n'; // close previous category-content
          }
          htmlBody += `<div class="category">${getCategoryIcon(category)} ${category}</div>\n`;
          htmlBody += `<div class="category-content">\n`;
          currentCategory = category;
          currentSubcategory = '';
        }

        if (subcategory !== currentSubcategory) {
          if (subSubcategoryOpen) {
            htmlBody += '</ul></div>\n';
            subSubcategoryOpen = false;
          }
          htmlBody += `<div class="subcategory">${subcategory}</div>\n`;
          htmlBody += `<div class="sub-subcategory"><ul>\n`;
          subSubcategoryOpen = true;
          currentSubcategory = subcategory;
        }

        htmlBody += `${liItem}\n`;
      }

      if (subSubcategoryOpen) htmlBody += '</ul></div>\n';
      if (currentCategory !== '') htmlBody += '</div>\n';

      const fullHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fishing Gear by Category</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
${fullCSS}
  </style>
</head>
<body>
<div class="container">
${htmlBody}
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".category").forEach(category => {
    category.addEventListener("click", () => {
      const next = category.nextElementSibling;
      const isVisible = next.style.display === "block";
      document.querySelectorAll(".category-content").forEach(content => {
        if (content !== next) content.style.display = "none";
      });
      next.style.display = isVisible ? "none" : "block";
    });
  });
});
<\/script>
</body>
</html>
`.trim();

      document.getElementById("htmlOutput").value = fullHTML;
      document.getElementById("livePreview").innerHTML = `<div class="container">${htmlBody}</div>`;

      document.querySelectorAll(".category").forEach(category => {
        category.addEventListener("click", () => {
          const next = category.nextElementSibling;
          const isVisible = next.style.display === "block";
          document.querySelectorAll(".category-content").forEach(content => {
            if (content !== next) content.style.display = "none";
          });
          next.style.display = isVisible ? "none" : "block";
        });
      });
    }

    function resetFields() {
      document.getElementById("csvInput").value = "";
      document.getElementById("htmlOutput").value = "";
      document.getElementById("livePreview").innerHTML = "";
    }

    function copyToClipboard() {
      const htmlText = document.getElementById("htmlOutput");
      htmlText.select();
      htmlText.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("HTML copied to clipboard!");
    }

    function saveAsHTML() {
      const htmlContent = document.getElementById("htmlOutput").value;
      if (!htmlContent.trim()) {
        alert("No HTML content to save!");
        return;
      }
      const filename = prompt("Enter a filename:", "FishingGear.html");
      if (!filename) return;

      const blob = new Blob([htmlContent], { type: "text/html" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      URL.revokeObjectURL(link.href);
    }
  </script>

</body>
</html>
